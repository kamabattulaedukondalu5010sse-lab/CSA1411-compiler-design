#include <stdio.h>
#include <string.h>
#include <stdlib.h>

char stack[50], input[50];
int top = 0, ip = 0;

/* Operator precedence table */
char prec[9][9] = {
/*      +    -    *    /    ^    i    (    )    $ */
/* + */ '>', '>', '<', '<', '<', '<', '<', '>', '>',
/* - */ '>', '>', '<', '<', '<', '<', '<', '>', '>',
/* * */ '>', '>', '>', '>', '<', '<', '<', '>', '>',
/* / */ '>', '>', '>', '>', '<', '<', '<', '>', '>',
/* ^ */ '>', '>', '>', '>', '<', '<', '<', '>', '>',
/* i */ '>', '>', '>', '>', '>', 'e', 'e', '>', '>',
/* ( */ '<', '<', '<', '<', '<', '<', '<', '>', 'e',
/* ) */ '>', '>', '>', '>', '>', 'e', 'e', '>', '>',
/* $ */ '<', '<', '<', '<', '<', '<', '<', '<', '>'
};

/* Grammar Handles */
char handles[][5] = {")E(", "E*E", "E+E", "i", "E^E"};

int getIndex(char c)
{
    switch (c)
    {
    case '+': return 0;
    case '-': return 1;
    case '*': return 2;
    case '/': return 3;
    case '^': return 4;
    case 'i': return 5;
    case '(': return 6;
    case ')': return 7;
    case '$': return 8;
    }
    return -1;
}

/* Display Stack */
void showStack()
{
    for (int i = 0; i <= top; i++)
        printf("%c", stack[i]);
}

/* Display Input */
void showInput()
{
    for (int i = ip; i < strlen(input); i++)
        printf("%c", input[i]);
}

/* Reduction */
int reduce()
{
    int i, j, len, found;

    for (i = 0; i < 5; i++)
    {
        len = strlen(handles[i]);
        found = 1;

        for (j = 0; j < len; j++)
        {
            if (stack[top - j] != handles[i][j])
            {
                found = 0;
                break;
            }
        }

        if (found)
        {
            top = top - len + 1;
            stack[top] = 'E';
            stack[top + 1] = '\0';
            return 1;
        }
    }
    return 0;
}

int main()
{
    printf("\nEnter Expression (use i for id): ");
    scanf("%s", input);

    strcat(input, "$");

    strcpy(stack, "$");

    printf("\nSTACK\tINPUT\tACTION");

    while (ip < strlen(input))
    {
        /* SHIFT */
        stack[++top] = input[ip++];
        stack[top + 1] = '\0';

        printf("\n");
        showStack();
        printf("\t");
        showInput();
        printf("\tSHIFT");

        /* REDUCE */
        while (prec[getIndex(stack[top])]
                   [getIndex(input[ip])] == '>')
        {
            if (reduce())
            {
                printf("\n");
                showStack();
                printf("\t");
                showInput();
                printf("\tREDUCE");
            }
            else
                break;
        }
    }

    if (strcmp(stack, "$E$") == 0)
        printf("\n\nString Accepted\n");
    else
        printf("\n\nString Rejected\n");

    return 0;
}


OUTPUT:

Enter Expression (use i for id): i*(i+i)*i

STACK   INPUT   ACTION
$i      *(i+i)*i$       SHIFT
$E      *(i+i)*i$       REDUCE
$E*     (i+i)*i$        SHIFT
$E*(    i+i)*i$ SHIFT
$E*(i   +i)*i$  SHIFT
$E*(E   +i)*i$  REDUCE
$E*(E+  i)*i$   SHIFT
$E*(E+i )*i$    SHIFT
$E*(E+E )*i$    REDUCE
$E*(E+E)        *i$     SHIFT
$E*(E+E)*       i$      SHIFT
$E*(E+E)*i      $       SHIFT
$E*(E+E)*E      $       REDUCE
$E*(E+E)*E$             SHIFT

String Rejected
